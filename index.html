<!doctype html>
<head>
  <meta charset="utf-8">
  <meta keyword="小猪代码">
  <title>小猪代码</title>
  <script src=https://pig-cmd.github.io/bmobSDK.js></script>
  <script>
    onload = function () {
      var username = sessionStorage.getItem("username");
      var uuid = sessionStorage.getItem("uuid");
      if ((username == null || username == "") && (uuid != null && uuid != ""))
        login();
      if ((username != null && username != "") && (uuid == null || uuid == ""))
        login();
      if (username == null && uuid == null)
      {
        document.getElementById("top-box").innerHTML = "小猪代码 <input type=button value=登录 onclick=javascript:login();> <input type=button value=注册 onclick=javascript:register();>";
      }
      else
      {
        document.getElementById("top-box").innerHTML = "小猪代码 <input type=button value=计算机硬件知识 onclick=javascript:location.href='knowladge#hard'><input type=button value=操作系统知识 onclick=javascript:location.href='knowladge#os'><input type=button value=编程语言知识 onclick=javascript:location.href='knowladge#program'><input type=button value=退出登录 onclick=javascript:logout();>";
        document.getElementById("mainbox").innerHTML = "<span style='font-size:2.5em;font-family:Cursive,Helvetica,sans-serif;white-space:pre-wrap'>关于我们</span><br>小猪代码创立于2021年2月8日，我们的使命是让编程更简单，让家长更放心<br>我们以图文教程的方式让孩子们学会有关编程的知识，相比于一些教育平台，我们的收费更低廉<br>我们的教程面向12~28岁人群，只要你有一定的编程基础，就可以学习我们的教程<br>我们提供C、JavaScript、Classic ASP、CSS、CMD教程，以及TCP/IP协议,HTTP协议基础，操作系统基础<br>您还可以参与我们的网站维护以及建设工作<br>有意图者请联系我们<br><a href=mailto:fat-pig-2020@outlook.com>fat-pig-2020@outlook.com</a><br>- <font color=red>Air工作室</font> - 经典之作 - 小猪代码<br>我们的其他产品<br><a href=https://chenglan28.github.io target=_blank>Air Virtual System</a> 空气虚拟系统 一套运行于网页的虚拟系统 由<font color=blue>橙蓝</font>制作<br><a href=https://ossplatform.github.io target=_blank>Open Source Storage Platform</a> 开源代码储存平台 给您的代码一个在云端上的家 由<font color=blue>Pig</font>制作<br><a href=https://cdn2021.github.io/command-chenglan/ target=_blank>Command</a>运行在网页的一套便利工具 由<font color=blue>橙蓝</font>制作<br><a href=https://pigbbs.github.io target=_blank>Pig BBS</a> 猪猪留言板 便利的留言板网站 由<font color=blue>橙蓝和Pig</font>制作  橙蓝负责CSS部分，Pig负责JS部分 <br><a href=https://pig-code-website.github.io target=_blank>小猪代码</a> 一个很好的代码学习平台 由<font color=blue>Pig</font>制作<br><br><br><hr>";
        document.getElementById("mainbox").innerHTML += "<span style='font-size:2.5em'>知识入口</span><br><span style='font-size:2em'>编程语言知识</span><br><a href=document#program/c/index target=_blank>C语言教程</a> <input type=button value=订阅 onclick=javascript:getbook('program/c');><br><a href=document#program/classic-asp/index>Classic ASP教程</a> <input type=button value=订阅 onclick=javascript:getbook('program/classic-asp');><br><a href=document#program/js/index target=_blank>JavaScript教程</a> <input type=button value=订阅 onclick=javascript:getbook('program/javascript');><br><a href=document#program/html/index target=_blank>HTML教程</a> <input type=button value=订阅 onclick=javascript:getbook('program/html');><br><a href=document#program/css/index target=_blank>CSS教程</a> <input  type=button value=订阅 onclick=javascript:getbook('program/css');><br><a href=document#program/xml/index target=_blank>XML教程</a> <input   value=订阅 type=button onclick=javascript:getbook('program/xml');><br><a href=document#program/json/index target=_blank>JSON教程</a> <input  value=订阅 type=button  onclick=javascript:getbook('program/json');><br><a href=document#program/css/index target=_blank>AJAX教程</a>  <input  value=订阅 type=button onclick=javascript:getbook('program/ajax');><br><a href=document#program/html-dom/index target=_blank>HTML-DOM教程</a>  <input  type=button value=订阅 onclick=javascript:getbook('program/html-dom');><br><a href=document#program/svg/index target=_blank>SVG教程</a> <input  value=订阅 type=button onclick=javascript:getbook('program/svg');><br><a href=document#program/cmd/index target=_blank>CMD教程</a> <input  type=button value=订阅 onclick=javascript:getbook('program/cmd');>";
      }
    };
    Bmob.initialize("9a7dbe424a6dd457","081126");
  </script>
  <script>
    function login()
    {
      document.getElementById("loginbox").innerHTML = "<table border=10><tr><td><span style='font-size:2em'>登录</span><br>用户名<input type=text maxlength=24 id=username><br>密码<input type=password maxlength=16 id=password><br><a onclick=javascript:register();>没有账户？点我注册</a><br><div id=login-status></div><br><span style='background:#00ff00;color:white;font-size:1.5em;position:absolute;top:90%;right:0%' onclick=javascript:submit_form_login();>登录</span><span style='background:red;color:white;font-size:1.5em;position:absolute;bottom:90%;right:0%' onclick=javascript:close_box_login();>X</span></td></tr></table>";
      document.getElementById("loginbox").className = "show-element";
    }
    function close_box_login()
    {
      document.getElementById("loginbox").className = "hide-element";
    }
    function close_box_get()
    {
      document.getElementById("get-box").className = "hide-element";
    }
    function getbook(n)
    {
      n = n.split("/")[1];
      sessionStorage.setItem("bookid",n);
      var pigcoin = sessionStorage.getItem("pigcoin");
      pigcoin = parseInt(pigcoin);
      var book = sessionStorage.getItem("book");
      if (book == null || book == "")
        book = {};
      else
        book = JSON.parse(book);
      var price;
      switch(n)
      {
        case "c":price = 800;break;
        case "classic-asp":price = 500;break;
        case "javascript":price = 600;break;
        case "html":price = 100;break;
        case "css":price = 500;break;
        case "xml":price = 20;break;
        case "json":price = 20;break;
        case "ajax":price = 50;break;
        case "html-dom":price = 500;break;
        case "svg":price = 50;break;
        case "cmd":price = 100;break;
        default:return;
      }
      if (pigcoin > -0.01)
        document.getElementById("get-box").innerHTML = "<table border=10><tr><td><span style='font-size:2em'>订阅</span><br>您订阅的是：" + n + "教程 价格：" + price + "猪头<br>您有" + pigcoin + "猪头<br><font color=red>小猪提示：您现在正在进行金钱交易<br>请谨慎操作，操作后不得撤销<br>请检查电脑中是否有木马、监控等软件<br>请检查是否有人对端口进行监听</font><br><div id=getstatus></div><br><span style='background:#00ff00;color:white;font-size:1.5em;position:absolute;top:90%;right:0%' onclick=javascript:submit_form_book();>订阅</span><span style='background:red;color:white;font-size:1.5em;position:absolute;bottom:90%;right:0%' onclick=javascript:close_box_get();>X</span></td></tr></table>";
      else
        document.getElementById("get-box").innerHTML = "<table border=10><tr><td><font color=red>向后端请求数据出现错误：您的猪头低于0，请联系工作人员进行处理</font><br>邮箱：<a href=mailto:fat-pig-2020@outlook.com>fat-pig-2020@outlook.com</a><br><span style='background:red;color:white;font-size:1.5em;position:absolute;bottom:90%;right:0%' onclick=javascript:close_box_get();>X</span></tr></td></table>";
      if (typeof book[n] != "undefined")
        document.getElementById("get-box").innerHTML = "<table border=10><tr><td><span style='font-size:2em'>订阅</span><br>您订阅的是：" + n + "教程 价格：" + price + "猪头<br>您有" + pigcoin + "猪头<br><font color=red>小猪提示：您现在正在进行金钱交易<br>请谨慎操作，操作后不得撤销<br>请检查电脑中是否有木马、监控等软件<br>请检查是否有人对端口进行监听</font><br><div id=getstatus><font color=red>您已订阅该教程，无法再次订阅</font></div><br><span style='background:red;color:white;font-size:1.5em;position:absolute;top:90%;right:0%' >订阅</span><span style='background:red;color:white;font-size:1.5em;position:absolute;bottom:90%;right:0%' onclick=javascript:close_box_get();>X</span></td></tr></table>";
      if (price > pigcoin)
        document.getElementById("get-box").innerHTML = "<table border=10><tr><td><span style='font-size:2em'>订阅</span><br>您订阅的是：" + n + "教程 价格：" + price + "猪头<br>您有" + pigcoin + "猪头<br><font color=red>小猪提示：您现在正在进行金钱交易<br>请谨慎操作，操作后不得撤销<br>请检查电脑中是否有木马、监控等软件<br>请检查是否有人对端口进行监听</font><br><div id=getstatus><font color=red>您的猪头不足，无法订阅</font></div><br><span style='background:red;color:white;font-size:1.5em;position:absolute;top:90%;right:0%'>订阅</span><span style='background:red;color:white;font-size:1.5em;position:absolute;bottom:90%;right:0%' onclick=javascript:close_box_get();>X</span></td></tr></table>";       
      document.getElementById("get-box").className = "show-element";
    }
    function submit_form_book()
    {
      var price;
      var bookid = sessionStorage.getItem("bookid");
      switch(bookid)
      {
        case "c":price = 800;break;
        case "classic-asp":price = 500;break;
        case "javascript":price = 600;break;
        case "html":price = 100;break;
        case "css":price = 500;break;
        case "xml":price = 20;break;
        case "json":price = 20;break;
        case "ajax":price = 50;break;
        case "html-dom":price = 500;break;
        case "svg":price = 50;break;
        case "cmd":price = 100;break;
        default:return;
      }
      const query = Bmob.Query("userinfo");
      var uuid = sessionStorage.getItem("uuid");
      query.get(uuid).then(res => {
        console.log(res);
        var pigcoin = res.pigcoin;
        if (typeof res.mybook == "undefined")
          var book = {};
        else
          var book = JSON.parse(res.mybook);
        if (pigcoin > price || pigcoin == price)
        {
          if (typeof book[bookid] == "undefined")
          {
            query.set("id",res.objectId);
            pigcoin -= price;
            book[bookid] = true;
            book = JSON.stringify(book);
            query.set("pigcoin",pigcoin);
            query.set("mybook",book);
            query.save().then(res => {
              console.log(res);
              document.getElementById("getstatus").innerHTML = "<font color=#00ff00>订阅成功！</font>";
              sessionStorage.setItem("pigcoin",pigcoin);
              sessionStorage.setItem("book",book);
            }).catch(err => {
              console.log(err);
              document.getElementById("getstatus").innerHTML = "<font color=red>未知的错误</font>";
            });
          } else
            document.getElementById("getstatus").innerHTML = "<font color=red>错误：您已订阅过该教程，无法再次订阅</font>";
        } else 
          document.getElementById("getstatus").innerHTML = "<font color=red>错误：您的猪头不足！无法订阅</font>";
      }).catch(err => {
        console.log(err);
        document.getElementById("getstatus").innerHTML = "<font color=red>未知的错误</font>";
      });
      
    }
    function register()
    {
      document.getElementById("loginbox").innerHTML = "<table border=10><tr><td><span style='font-size:2em'>注册</span><br>用户名<input type=text maxlength=24 id=username><br>密码<input type=password maxlength=16 id=password><br>验证密码<input type=password maxlength=16 id=password2><br><a onclick=javascript:login();>登录</a><br><div id=login-status></div><br><span style='background:#00ff00;color:white;font-size:1.5em;position:absolute;top:90%;right:0%' onclick=javascript:submit_form_register();>注册</span><span style='background:red;color:white;font-size:1.5em;position:absolute;bottom:90%;right:0%' onclick=javascript:close_box_login();>X</span></td></tr></table>";
      document.getElementById("loginbox").className = "show-element";
    }
    function submit_form_login()
    {
      var username = document.getElementById("username").value;
      var password = document.getElementById("password").value;
      Bmob.User.login(username,password).then(res => {
        console.log(res);
        sessionStorage.setItem("username",username);
        sessionStorage.setItem("uuid",res.uuid);
        var i = 0;
        var q = Bmob.Query("userinfo");
        q.get(res.uuid).then(res => {
          console.log(res);
          sessionStorage.setItem("pigcoin",res.pigcoin);
          if (typeof res.mybook == "undefined")
            sessionStorage.setItem("book","");
          else
            sessionStorage.setItem("book",res.mybook);
        }).catch(err => {
          console.log(err);
          document.getElementById("login-status").innerHTML = "<font color=red>未知的错误</font>";
        });
        setInterval(function(){
          document.getElementById("login-status").innerHTML = "<font color=#00ff00>登录成功！将在" + (10 - i) + "秒后刷新</font>";
          i++;
          if (i > 10)
            location.reload();
        },1000);
      }).catch(err => {
              console.log(err);
              if (err.code == 101)
                document.getElementById("login-status").innerHTML = "<font color=red>登录失败！用户名或密码错误</font>";
              else
                document.getElementById("login-status").innerHTML = "<font color=red>未知的错误</font>";
        });
    }
    function submit_form_register()
    {
      var username = document.getElementById("username").value;
      var password = document.getElementById("password").value;
      var p2 = document.getElementById("password2").value;
      if (p2 != password)
      {
        document.getElementById("login-status").innerHTML = "<font color=red>注册失败！密码与验证密码不符</font>";
        return;
      }
      if (username.length < 8 || password.length < 8 || username.length > 24 || password.length > 16)
      {
        document.getElementById("login-status").innerHTML = "<font color=red>注册失败！用户名或密码过短或过长<br>用户名长度应该为8~24字<br>密码长度应该为8~16位</font>";
        return;
      }
      var email = Math.random().toString().substring(3) + "@smtp.pig.org";
      var phone = parseInt(Math.random().toString().substring(3,14));
      let userinfo = {"username":username,"password":password,"phone":phone,"email":email};
      var q = Bmob.Query("userinfo");
      q.set("username",username);
      q.set("password",password);
      q.set("pigcoin",0);
      q.set("mybook","{}");
      q.save().then(res=> {
        var r1 = res;
        console.log(res);
        userinfo.uuid = r1.objectId;
        Bmob.User.register(userinfo).then(res => {
          console.log(res);
          sessionStorage.setItem("username",username);
          sessionStorage.setItem("uuid",r1.objectId);
          sessionStorage.setItem("pigcoin",0);
          sessionStorage.setItem("book","");
         var i = 0;
         setInterval(function(){
            document.getElementById("login-status").innerHTML = "<font color=#00ff00>注册成功！将在" + (10 - i) + "秒后刷新</font>";
            i++;
            if (i > 10)
             location.reload();
          },1000);
        }).catch(err => {
               console.log(err);
              if (err.code != 202)
                document.getElementById("login-status").innerHTML = "<font color=red>未知的错误</font>";
               if (err.code == 400 || err.code == 203)
                  submit_form_register();
                if (err.code == 202)
                  document.getElementById("login-status").innerHTML = "<font color=red>注册失败！用户名重复！</font>";

                 
         });
     }).catch(err => {
        console.log(err);
      document.getElementById("login-status").innerHTML = "<font color=red>未知的错误</font>";
        submit_form_register();

                
      });
    }
    
  function logout()
    {
      sessionStorage.removeItem("username");
      sessionStorage.removeItem("uuid");
      sessionStorage.removeItem("book");
      sessionStorage.removeItem("bookid");
      sessionStorage.removeItem("pigcoin");
      localStorage.removeItem("bmob");
      localStorage.removeItem("OTelJS.ClientId");
      location.reload();
    }
  </script>
  <style>
    .hide-element
    {
      display:none;
    }
  </style>
</head>
<body>
  <center>
  <span style='color:white;background:black;text-ailgn:center' id=top-box></span>
    <br>
  <span style='font-size:3em;text-ailgn:center;'>小猪代码</span>
  <div id=mainbox>
    <span style='font-size:2em;color:red'>在您开始学习前，我们建议您先注册/登录<br><input type=button value=注册 onclick=javascript:register();><br><input type=button value=登录 onclick=javascript:login();></span>
  </div>
    <div id=loginbox class=hide-element style='position:fixed;top:20%;left:40%;color:black;background:white'></div>
    <div id=get-box class=hide-element style='position:fixed;top:50%;left:40%;color:black;background:skyblue'></div>
  </center>
</body>
